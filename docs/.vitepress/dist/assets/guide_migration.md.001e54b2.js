import{_ as e,c as o,o as a,a as s}from"./app.1478ba28.js";const m=JSON.parse('{"title":"Migration from v2","description":"","frontmatter":{},"headers":[{"level":2,"title":"Node Support","slug":"node-support"},{"level":2,"title":"Modern Browser Baseline change","slug":"modern-browser-baseline-change"},{"level":2,"title":"Config Options Changes","slug":"config-options-changes"},{"level":2,"title":"Architecture changes and legacy Options","slug":"architecture-changes-and-legacy-options"},{"level":3,"title":"Dev Server Changes","slug":"dev-server-changes"},{"level":3,"title":"Build Changes","slug":"build-changes"},{"level":3,"title":"SSR Changes","slug":"ssr-changes"},{"level":2,"title":"General Changes","slug":"general-changes"},{"level":3,"title":"import.meta.glob","slug":"import-meta-glob"},{"level":3,"title":"WebAssembly support","slug":"webassembly-support"},{"level":3,"title":"Automatic https certificate generation","slug":"automatic-https-certificate-generation"},{"level":2,"title":"Advanced","slug":"advanced"},{"level":2,"title":"Migration from v1","slug":"migration-from-v1"}],"relativePath":"guide/migration.md"}'),t={name:"guide/migration.md"},n=s(`<h1 id="migration-from-v2" tabindex="-1">Migration from v2 <a class="header-anchor" href="#migration-from-v2" aria-hidden="true">#</a></h1><h2 id="node-support" tabindex="-1">Node Support <a class="header-anchor" href="#node-support" aria-hidden="true">#</a></h2><p>Vite no longer supports Node v12, which reached its EOL. Node 14.18+ is now required.</p><h2 id="modern-browser-baseline-change" tabindex="-1">Modern Browser Baseline change <a class="header-anchor" href="#modern-browser-baseline-change" aria-hidden="true">#</a></h2><p>The production bundle assumes support for modern JavaScript. By default, Vite targets browsers which support the <a href="https://caniuse.com/es6-module" target="_blank" rel="noopener noreferrer">native ES Modules</a> and <a href="https://caniuse.com/es6-module-dynamic-import" target="_blank" rel="noopener noreferrer">native ESM dynamic import</a> and <a href="https://caniuse.com/mdn-javascript_statements_import_meta" target="_blank" rel="noopener noreferrer"><code>import.<wbr>meta</code></a>:</p><ul><li>Chrome &gt;=87</li><li>Firefox &gt;=78</li><li>Safari &gt;=13</li><li>Edge &gt;=88</li></ul><p>A small fraction of users will now require using <a href="https://github.com/vitejs/vite/tree/main/packages/plugin-legacy" target="_blank" rel="noopener noreferrer">@vitejs/plugin-legacy</a>, which will automatically generate legacy chunks and corresponding ES language feature polyfills.</p><h2 id="config-options-changes" tabindex="-1">Config Options Changes <a class="header-anchor" href="#config-options-changes" aria-hidden="true">#</a></h2><ul><li><p>The following options that were already deprecated in v2 have been removed:</p><ul><li><code>alias</code> (switch to <a href="./../config/shared-options.html#resolve-alias"><code>resolve.alias</code></a>)</li><li><code>dedupe</code> (switch to <a href="./../config/shared-options.html#resolve-dedupe"><code>resolve.dedupe</code></a>)</li><li><code>build.base</code> (switch to <a href="./../config/shared-options.html#base"><code>base</code></a>)</li><li><code>build.brotliSize</code> (switch to <a href="./../config/build-options.html#build-reportcompressedsize"><code>build.reportCompressedSize</code></a>)</li><li><code>build.cleanCssOptions</code> (Vite now uses esbuild for CSS minification)</li><li><code>build.polyfillDynamicImport</code> (use <a href="https://github.com/vitejs/vite/tree/main/packages/plugin-legacy" target="_blank" rel="noopener noreferrer"><code>@vitejs/plugin-legacy</code></a> for browsers without dynamic import support)</li><li><code>optimizeDeps.keepNames</code> (switch to <a href="./../config/dep-optimization-options.html#optimizedeps-esbuildoptions"><code>optimizeDeps.esbuildOptions.keepNames</code></a>)</li></ul></li></ul><h2 id="architecture-changes-and-legacy-options" tabindex="-1">Architecture changes and legacy Options <a class="header-anchor" href="#architecture-changes-and-legacy-options" aria-hidden="true">#</a></h2><p>This section describes the biggest architecture changes in Vite v3. To allow projects to migrate from v2 in case of a compat issue, legacy options have been added to revert to the Vite v2 strategies.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>These options are marked as experimental and deprecated. They may be removed in a future v3 minor without respecting semver. Please pin the Vite version when using them.</p><ul><li><code>legacy.buildRollupPluginCommonjs</code></li><li><code>legacy.buildSsrCjsExternalHeuristics</code></li></ul></div><h3 id="dev-server-changes" tabindex="-1">Dev Server Changes <a class="header-anchor" href="#dev-server-changes" aria-hidden="true">#</a></h3><p>Vite&#39;s default dev server port is now 5173. You can use <a href="./../config/server-options.html#server-port"><code>server.port</code></a> to set it to 3000.</p><p>Vite&#39;s default dev server host is now <code>localhost</code>. You can use <a href="./../config/server-options.html#server-host"><code>server.host</code></a> to set it to <code>127.0.0.1</code>.</p><h3 id="build-changes" tabindex="-1">Build Changes <a class="header-anchor" href="#build-changes" aria-hidden="true">#</a></h3><p>In v3, Vite uses esbuild to optimize dependencies by default. Doing so, it removes one of the most significant differences between dev and prod present in v2. Because esbuild converts CJS-only dependencies to ESM, <a href="https://github.com/rollup/plugins/tree/master/packages/commonjs" target="_blank" rel="noopener noreferrer"><code>@rollupjs/plugin-commonjs</code></a> is no longer used.</p><p>If you need to get back to the v2 strategy, you can use <code>legacy.buildRollupPluginCommonjs</code>.</p><h3 id="ssr-changes" tabindex="-1">SSR Changes <a class="header-anchor" href="#ssr-changes" aria-hidden="true">#</a></h3><p>Vite v3 uses ESM for the SSR build by default. When using ESM, the <a href="https://vitejs.dev/guide/ssr.html#ssr-externals" target="_blank" rel="noopener noreferrer">SSR externalization heuristics</a> are no longer needed. By default, all dependencies are externalized. You can use <a href="./../config/ssr-options.html#ssr-noexternal"><code>ssr.noExternal</code></a> to control what dependencies to include in the SSR bundle.</p><p>If using ESM for SSR isn&#39;t possible in your project, you can set <code>legacy.buildSsrCjsExternalHeuristics</code> to generate a CJS bundle using the same externalization strategy of Vite v2.</p><p>Also <a href="https://rollupjs.org/guide/en/#outputinlinedynamicimports" target="_blank" rel="noopener noreferrer"><code>build.rollupOptions.output.inlineDynamicImports</code></a> now defaults to <code>false</code> when <code>ssr.target</code> is <code>&#39;node&#39;</code>. <code>inlineDynamicImports</code> changes execution order and bundling to a single file is not needed for node builds.</p><h2 id="general-changes" tabindex="-1">General Changes <a class="header-anchor" href="#general-changes" aria-hidden="true">#</a></h2><ul><li>JS file extensions in SSR and lib mode now use a valid extension (<code>js</code>, <code>mjs</code>, or <code>cjs</code>) for output JS entries and chunks based on their format and the package type.</li><li>Terser is now an optional dependency. If you are using <code>build.minify: &#39;terser&#39;</code>, you need to install it.<div class="language-shell"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">npm add -D terser</span></span>
<span class="line"></span></code></pre></div></li></ul><h3 id="import-meta-glob" tabindex="-1"><code>import.<wbr>meta.glob</code> <a class="header-anchor" href="#import-meta-glob" aria-hidden="true">#</a></h3><ul><li><p><a href="./features.html#glob-import-as">Raw <code>import.<wbr>meta.glob</code></a> switched from <code>{ assert: { type: &#39;raw&#39; }}</code> to <code>{ as: &#39;raw&#39; }</code></p></li><li><p>Keys of <code>import.<wbr>meta.glob</code> are now relative to the current module.</p><div class="language-diff"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">// file: /foo/index.js</span></span>
<span class="line"><span style="color:#A6ACCD;">const modules = import.<wbr>meta.glob(&#39;../foo/*.js&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">// transformed:</span></span>
<span class="line"><span style="color:#A6ACCD;">const modules = {</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">  &#39;../foo/bar.js&#39;: () =&gt; {}</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">  &#39;./bar.js&#39;: () =&gt; {}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>When using an alias with <code>import.<wbr>meta.glob</code>, the keys are always absolute.</p></li><li><p><code>import.<wbr>meta.globEager</code> is now deprecated. Use <code>import.<wbr>meta.glob(&#39;*&#39;, { eager: true })</code> instead.</p></li></ul><h3 id="webassembly-support" tabindex="-1">WebAssembly support <a class="header-anchor" href="#webassembly-support" aria-hidden="true">#</a></h3><p><code>import init from &#39;example.wasm&#39;</code> syntax is dropped to prevent future collision with <a href="https://github.com/WebAssembly/esm-integration" target="_blank" rel="noopener noreferrer">&quot;ESM integration for Wasm&quot;</a>. You can use <code>?init</code> which is similar to the previous behavior.</p><div class="language-diff"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">import init from &#39;example.wasm&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">import init from &#39;example.wasm?init&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;">init().then((exports) =&gt; {</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">init().then(({ exports }) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  exports.test()</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"></span></code></pre></div><h3 id="automatic-https-certificate-generation" tabindex="-1">Automatic https certificate generation <a class="header-anchor" href="#automatic-https-certificate-generation" aria-hidden="true">#</a></h3><p>A valid certificate is needed when using <code>https</code>. In Vite v2, if no certificate was configured, a self-signed certificate was automatically created and cached. Since Vite v3, we recommend manually creating your certificates. If you still want to use the automatic generation from v2, this feature can be enabled back by adding <a href="https://github.com/vitejs/vite-plugin-basic-ssl" target="_blank" rel="noopener noreferrer">@vitejs/plugin-basic-ssl</a> to the project plugins.</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> basicSsl </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-basic-ssl</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">basicSsl</span><span style="color:#A6ACCD;">()]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="advanced" tabindex="-1">Advanced <a class="header-anchor" href="#advanced" aria-hidden="true">#</a></h2><p>There are some changes which only affects plugin/tool creators.</p><ul><li><a href="https://github.com/vitejs/vite/pull/5868" target="_blank" rel="noopener noreferrer">[#5868] refactor: remove deprecated api for 3.0</a><ul><li><code>printHttpServerUrls</code> is removed</li><li><code>server.app</code>, <code>server.transformWithEsbuild</code> are removed</li><li><code>import.<wbr>meta.hot.acceptDeps</code> is removed</li></ul></li><li><a href="https://github.com/vitejs/vite/pull/6901" target="_blank" rel="noopener noreferrer">[#6901] fix: sequential injection of tags in transformIndexHtml</a><ul><li><code>transformIndexHtml</code> now gets the correct content modified by earlier plugins, so the order of the injected tags now works as expected.</li></ul></li><li><a href="https://github.com/vitejs/vite/pull/7995" target="_blank" rel="noopener noreferrer">[#7995] chore: do not fixStacktrace</a><ul><li><code>ssrLoadModule</code>&#39;s <code>fixStacktrace</code> option&#39;s default is now <code>false</code></li></ul></li><li><a href="https://github.com/vitejs/vite/pull/8178" target="_blank" rel="noopener noreferrer">[#8178] feat!: migrate to ESM</a><ul><li><code>formatPostcssSourceMap</code> is now async</li><li><code>resolvePackageEntry</code>, <code>resolvePackageData</code> are no longer available from CJS build (dynamic import is needed to use in CJS)</li></ul></li><li><a href="https://github.com/vitejs/vite/pull/8626" target="_blank" rel="noopener noreferrer">[#8626] refactor: type client maps</a><ul><li>Type of callback of <code>import.<wbr>meta.hot.accept</code> is now stricter. It is now <code>(mod: (Record&lt;string, any&gt; &amp; { [Symbol.toStringTag]: &#39;Module&#39; }) | undefined) =&gt; void</code> (was <code>(mod: any) =&gt; void</code>).</li></ul></li></ul><p>Also there are other breaking changes which only affect few users.</p><ul><li><a href="https://github.com/vitejs/vite/pull/5018" target="_blank" rel="noopener noreferrer">[#5018] feat: enable <code>generatedCode: &#39;es2015&#39;</code> for rollup build</a><ul><li>Transpile to ES5 is now necessary even if the user code only includes ES5.</li></ul></li><li><a href="https://github.com/vitejs/vite/pull/7877" target="_blank" rel="noopener noreferrer">[#7877] fix: vite client types</a><ul><li><code>/// &lt;reference lib=&quot;dom&quot; /&gt;</code> is removed from <code>vite/client.d.ts</code>. <code>{ &quot;lib&quot;: [&quot;dom&quot;] }</code> or <code>{ &quot;lib&quot;: [&quot;webworker&quot;] }</code> is necessary in <code>tsconfig.json</code>.</li></ul></li><li><a href="https://github.com/vitejs/vite/pull/8090" target="_blank" rel="noopener noreferrer">[#8090] feat: preserve process env vars in lib build</a><ul><li><code>process.<wbr>env.*</code> is now preserved in library mode</li></ul></li><li><a href="https://github.com/vitejs/vite/pull/8280" target="_blank" rel="noopener noreferrer">[#8280] feat: non-blocking esbuild optimization at build time</a><ul><li><code>server.force</code> option was removed in favor of <code>optimizeDeps.force</code> option.</li></ul></li><li><a href="https://github.com/vitejs/vite/pull/8550" target="_blank" rel="noopener noreferrer">[#8550] fix: dont handle sigterm in middleware mode</a><ul><li>When running in middleware mode, Vite no longer kills process on <code>SIGTERM</code>.</li></ul></li><li><a href="https://github.com/vitejs/vite/pull/8647" target="_blank" rel="noopener noreferrer">[#8647] feat: print resolved address for localhost</a><ul><li><code>server.printUrls</code> and <code>previewServer.printUrls</code> are now async</li></ul></li></ul><h2 id="migration-from-v1" tabindex="-1">Migration from v1 <a class="header-anchor" href="#migration-from-v1" aria-hidden="true">#</a></h2><p>Check the <a href="https://v2.vitejs.dev/guide/migration.html" target="_blank" rel="noopener noreferrer">Migration from v1 Guide</a> in the Vite v2 docs first to see the needed changes to port your app to Vite v2, and then proceed with the changes on this page.</p>`,39),r=[n];function i(l,c,d,p,h,u){return a(),o("div",null,r)}var f=e(t,[["render",i]]);export{m as __pageData,f as default};
